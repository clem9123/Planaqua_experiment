---
title: "R Notebook"
output: html_notebook
---


```{r message=FALSE, warning=FALSE}
library(R2jags)
library(tidyverse)
library(arules)
library(patchwork)

load("R/model_final/Model_Treatment.RData")
load("R/model_final/Model_Treatment_time_and_lake.RData")
load("R/model_final/Model_Treatment_time_x_lake.RData")

source("R/importation_data.R")
```

```{r}
traceplot(Model_Treatment_time_x_lake, ask = F)#[[2]]$mean)
```

Deviance = 9990
DIC = 21 575

C'est beaucoup (plus que Treatment tout simple) malgré cet augmentation de la liberté
C'est bizarre

Ca n'a pas convergé en fait donc normal
Je sais pas trop quoi faire du coup 
  Soit le model est mal écrit
  Soit pas assez de puissance
  ou bien mauvaise initialisation
    surtout mu et epsilon


```{r}
print(Model_Treatment[[2]]$mean)
```

Deviance = 9336
DIC = 17 892

```{r}
print(Model_Treatment_time_x_lake[[2]]$mean)
```

Deviance = 8629
DIC = 15 382

```{r}
epsilon_phi <- data.frame(Lake = factor(1:16), 
                          Treatment = Lake_treatment$Treatment, 
                          epsilon_phi = Model_Treatment_time_and_lake[[2]]$mean$epsilon_phi)

ggplot(epsilon_phi)+
  geom_point(aes(x = Lake ,y = epsilon_phi, color = Treatment))
```

```{r}
epsilon_psi <- data.frame(Lake = factor(1:16), 
                          Treatment = Lake_treatment$Treatment, 
                          epsilon_psi = Model_Treatment_time_and_lake[[2]]$mean$epsilon_psi)

ggplot(epsilon_psi)+
  geom_point(aes(x = Lake ,y = epsilon_psi, color = Treatment))
```

```{r}
model = as.mcmc(Model_Treatment_time_x_lake)
phi = data.frame()
for (n in 1:2){
  for (tr in 1:4){
    for (gs in 1:3){
      for (e in 1:2){
        phi <- rbind(phi, 
               data.frame(model[[n]][,paste("phi",as.character(gs),"[",as.character(tr),",",as.character(e),"]", sep = "")],
                          Size = gs,
                          Treatment = tr,
                          Exp_time = e))
      }
    }
  }
}

sum_phi = phi %>% group_by (Size,Treatment,Exp_time) %>% summarize(mean = mean(var1), min = quantile(var1,0.025), max = quantile(var1,0.975))

ggplot(sum_phi, aes(color = factor(Treatment)))+
  geom_point(aes(x = Treatment, y = mean))+
  geom_errorbar(aes(x = Treatment, ymin = min, ymax = max), width = 0.4)+
  facet_grid(rows = vars(Size), cols = vars(Exp_time))

ggplot(phi)+
  geom_density(aes(x = var1, color = factor(Treatment)))+
  facet_grid(rows = vars(Size), cols = vars(Exp_time))

```

```{r}
model = as.mcmc(Model_Treatment)
phi = data.frame()
for (n in 1:2){
  for (tr in 1:4){
    for (gs in 1:3){
      for (e in 1:2){
        phi <- rbind(phi, 
               data.frame(model[[n]][,paste("phi",as.character(gs),"[",as.character(tr),",",as.character(e),"]", sep = "")],
                          Size = gs,
                          Treatment = tr,
                          Exp_time = e))
      }
    }
  }
}

sum_phi = phi %>% group_by (Size,Treatment,Exp_time) %>% summarize(mean = mean(var1), min = quantile(var1,0.025), max = quantile(var1,0.975))

ggplot(sum_phi, aes(color = factor(Treatment)))+
  geom_point(aes(x = Treatment, y = mean))+
  geom_errorbar(aes(x = Treatment, ymin = min, ymax = max), width = 0.4)+
  facet_grid(rows = vars(Size), cols = vars(Exp_time))
```

```{r}
model = as.mcmc(Model_Treatment_time_x_lake)
phi = data.frame()
for (n in 1:2){
  for (tr in 1:4){
    for (gs in 1:3){
      for (e in 1:2){
        phi <- rbind(phi, 
               data.frame(model[[n]][,paste("phi",as.character(gs),"[",as.character(tr),",",as.character(e),"]", sep = "")],
                          Size = gs,
                          Treatment = tr,
                          Exp_time = e))
      }
    }
  }
}

sum_phi = phi %>% group_by (Size,Treatment,Exp_time) %>% summarize(mean = mean(var1), min = quantile(var1,0.025), max = quantile(var1,0.975))

ggplot(sum_phi, aes(color = factor(Treatment)))+
  geom_point(aes(x = Treatment, y = mean))+
  geom_errorbar(aes(x = Treatment, ymin = min, ymax = max), width = 0.4)+
  facet_grid(rows = vars(Size), cols = vars(Exp_time))
```


```{r}
model = as.mcmc(Model_Treatment_time_x_lake)
psi = data.frame()
for (n in 1:2){
  for (tr in 1:4){
    for (gs in 1:2){
      for (e in 1:2){
        psi <- rbind(psi, 
               data.frame(model[[n]][,paste("psi",as.character(gs),as.character(gs+1),"[",as.character(tr),",",as.character(e),"]", sep = "")],
                          Size = gs,
                          Treatment = tr,
                          Exp_time = e))
      }
    }
  }
}

sum_psi = psi %>% group_by (Size,Treatment,Exp_time) %>% summarize(mean = mean(var1), min = quantile(var1,0.025), max = quantile(var1,0.975))

ggplot(sum_psi, aes(color = factor(Treatment)))+
  geom_point(aes(x = Treatment, y = mean))+
  geom_errorbar(aes(x = Treatment, ymin = min, ymax = max), width = 0.4)+
  facet_grid(rows = vars(Size), cols = vars(Exp_time))
```

```{r}
model = as.mcmc(Model_Treatment)
psi = data.frame()
for (n in 1:2){
  for (tr in 1:4){
    for (gs in 1:2){
      for (e in 1:2){
        psi <- rbind(psi, 
               data.frame(model[[n]][,paste("psi",as.character(gs),as.character(gs+1),"[",as.character(tr),",",as.character(e),"]", sep = "")],
                          Size = gs,
                          Treatment = tr,
                          Exp_time = e))
      }
    }
  }
}

sum_psi = psi %>% group_by (Size,Treatment,Exp_time) %>% summarize(mean = mean(var1), min = quantile(var1,0.025), max = quantile(var1,0.975))

ggplot(sum_psi, aes(color = factor(Treatment)))+
  geom_point(aes(x = Treatment, y = mean))+
  geom_errorbar(aes(x = Treatment, ymin = min, ymax = max), width = 0.4)+
  facet_grid(rows = vars(Size), cols = vars(Exp_time))
```

```{r}
model = as.mcmc(Model_Treatment_time_x_lake)
epsilon_phi = data.frame()
for (n in 1:2){
  for (l in 1:16){
      for (t in 1:5){
        epsilon_phi <- rbind(epsilon_phi, 
               data.frame(model[[n]][,paste("epsilon_phi","[",as.character(l),",",as.character(t),"]", sep = "")],
                          Year = t,
                          Lake = l))
    }
  }
}

sum_epsilon_phi = epsilon_phi %>% group_by (Year,Lake) %>% summarize(mean = mean(var1), min = quantile(var1,0.025), max = quantile(var1,0.975))

ggplot(sum_epsilon_phi)+#, aes(color = factor(Treatment)))+
  geom_point(aes(x = Year, y = mean))+
  geom_errorbar(aes(x = Year, ymin = min, ymax = max), width = 0.4)+
  facet_wrap(~Lake)
```








