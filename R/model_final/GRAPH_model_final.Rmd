---
title: "R Notebook"
output: html_notebook
---

```{r}
theme_set(theme_bw()+
            theme(strip.background =element_rect(fill="white", color = "darkgrey"),
                  panel.background = element_rect(fill = "#E6E6E6"),
                  panel.grid = element_line(colour = "#D8D8D8"),
                  panel.border = element_rect(color = "darkgrey"),
                  axis.title.x = element_text(margin = margin(t = 10)),
                  axis.title.y = element_text(margin = margin(r = 10))))
```


```{r message=FALSE, warning=FALSE, include=FALSE}
setwd("C:/Users/sandrine/Documents/R_script/Planaqua_experiment")
source("R/model_final/MODEL_visualisation_function.R")
source("R/setup.R")
```


```{r}

load("Model_Treatment.RData")
load("Model_Treatment_time_and_lake.RData")
load("Model_Treatment_time_x_lake.RData")
load("Model_Treatment_capture.RData")
load("Model_Treatment_capture_p1.RData")
  
  
list_model = list(
  Model_Treatment,
  Model_Treatment_time_and_lake,
  Model_Treatment_time_x_lake,
  Model_Treatment_capture,
  Model_Treatment_capture_p1
)

model_name = c(
  "Model_Treatment",
  "Model_Treatment_time_and_lake",
  "Model_Treatment_time_x_lake",
  "Model_Treatment_capture",
  "Model_Treatment_capture_p1"
)
```

```{r}
plot_deviance(list_model,model_name)
```


```{r}
for (i in 1:5){
  model = list_model[[i]]
  print(plot_p(model)+
    labs(title= model_name[i]))
}
```

```{r message=FALSE}
for (i in 1:5){
  model = list_model[[i]]
  print(plot_phi(model)+
    labs(title= model_name[i]))
}
```

```{r}
for (i in 1:5){
  model = list_model[[i]]
  print(plot_psi(model)+
    labs(title= model_name[i]))
}
```


```{r}
for (i in 4:5){
  model = list_model[[i]]
  print(plot_epsilon(model)+
    labs(title= model_name[i]))
}
```


```{r}
quantile(as.mcmc(Model_Treatment_capture)[[2]][,"error"], probs = 0.025, digits = )
mean(as.mcmc(Model_Treatment_capture)[[2]][,"error"])
print(Model_Treatment_capture$summary)
```

```{r}
quantile(as.mcmc(Model_Treatment_capture_p1)[[2]][,"p3"], probs = 0.025, digits = )
mean(as.mcmc(Model_Treatment_capture_p1)[[2]][,"p3"])
quantile(as.mcmc(Model_Treatment_capture_p1)[[2]][,"p3"],0.975)
```

Toutes les figures pour mon rapport
```{r}
model = Model_Treatment_capture

ggplot(get_p(model))+
  geom_point(aes(x = Size, y = mean))+
  geom_errorbar(aes(x = Size, 
                    ymin = min, ymax = max), width = 0.4)+
  labs(y = "Capture probability", x = "Size group")+
  ylim(0,1)

ggplot(get_phi(model) %>% filter(Exp_time == "After treatment"), aes(color = factor(Treatment)))+
  geom_point(aes(x = Treatment, y = mean))+
  geom_errorbar(aes(x = Treatment, ymin = min, ymax = max), width = 1)+
  scale_color_discrete("Treatment")+
  facet_wrap(~Size)+
  theme(axis.text.x=element_blank(),axis.ticks=element_blank(),axis.title.x=element_blank())+
  labs(y = "Survival probability")+
  ylim(0,1)

ggplot(get_psi(model) %>% filter(Exp_time == "After treatment"), aes(color = factor(Treatment)))+
  geom_point(aes(x = Treatment, y = mean))+
  geom_errorbar(aes(x = Treatment, ymin = min, ymax = max), width = 1)+
  facet_wrap(~Size)+
  scale_color_discrete("Treatment")+
  theme(axis.text.x=element_blank(),axis.ticks=element_blank(),axis.title.x=element_blank())+
  labs(y = "Growth probability")+
  ylim(0,1)

ggplot(get_n(model))+
  geom_bar(stat = "identity", aes(x = Year, y = mean, fill = Size))+
  #geom_errorbar(aes(x = Year, ymin =min, ymax = max))+
  scale_fill_manual (values =c("#FED98E","#FE9929","#CC4C02"))+
  labs(y = "Abundance")+
  facet_wrap(~Treatment)

ggplot(get_epsilon(model))+
  geom_point(aes(x = factor(Lake), y = mean))+
  geom_errorbar(aes(x = factor(Lake), ymin = min, ymax = max), width = 0.4)+
  facet_wrap(~Year)+
  labs(x = "Lake", y = "Epsilon : variation around the capture probability")

```





