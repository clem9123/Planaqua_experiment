---
title: "R Notebook"
output: html_notebook
---


```{r}
library(jagsUI)


######  Test avec mes donn√©es_construction

t <- BDD_a %>% ungroup () %>% pivot_wider(id_cols = Tag_id, names_from = Year, values_from =Lake)
t[] <- lapply(t, as.character)
t[!is.na(t)] <- "1"
t[is.na(t)] <- "0"
t <- data.frame(sapply(t,as.numeric))
t <- as.matrix(t)

CH <- t

get.first <- function(x) min(which(x!=0))
f <- apply(CH, 1, get.first)

# Bundle data
jags.data <- list(y = CH, 
                  f = f, 
                  nind = nrow(CH), 
                  n.occasions = ncol(CH))

# Initial values
# It is vital to specify "good" initial values for the latent state variable z. 
# Here is one possibility that works well.
z.inits <- function(ch){
  state <- ch
  state[state==0] <- 1
  #get.first <- function(x) min(which(x!=0))
  f <- apply(ch, 1, get.first)
  for (i in 1:nrow(ch)){
    state[i,1:f[i]] <- NA
  }
  return(state)
}


inits <- function(){list(mean.phi = runif(1, 0, 1), 
                         mean.p = runif(1, 0, 1), 
                         z = z.inits(CH))}

# Parameters monitored
parameters <- c("mean.phi", "mean.p")

# MCMC settings
ni <- 1000
nt <- 1
nb <- 500
nc <- 3

# Call JAGS from R (BRT 1 min)
cjs.c.c <- jags(data = jags.data, 
                inits = inits, 
                parameters.to.save = parameters, 
                model.file = "model_cjs_0.txt", 
                n.chains = nc, 
                n.thin = nt, 
                n.iter = ni, 
                n.burnin = nb)
?jags
# Summarize posteriors
print(cjs.c.c, digits = 3)
```


